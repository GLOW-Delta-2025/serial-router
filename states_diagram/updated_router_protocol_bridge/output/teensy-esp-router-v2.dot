digraph teensy_esp_router_v2 {
  rankdir=LR;
  fontname=Helvetica;
  node [shape=rectangle, fontname=Helvetica, style=filled];
  "S_IDLE_ROUTER" [label="S_IDLE_ROUTER\nROUTER_IDLE", fillcolor="#F28C28", tooltip="{\"owner\": \"ROUTER\", \"role\": \"neutral\", \"description\": \"Router ready to route frames and track outstanding exchanges\"}"];

  "S_REQ_101_MAKE_STAR" [label="S_REQ_101_MAKE_STAR\nREQUEST_MAKE_STAR", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC instructs the addressed arm to begin capturing microphone data for a star\"}"];

  "S_CONF_201_MAKE_STAR" [label="S_CONF_201_MAKE_STAR\nCONFIRM_MAKE_STAR", fillcolor="#F4C95D", tooltip="{\"owner\": \"ARM\", \"role\": \"confirm\", \"description\": \"Arm confirms it has entered star buildup mode and is sampling parameters\"}"];

  "S_REQ_102_SEND_STAR" [label="S_REQ_102_SEND_STAR\nREQUEST_SEND_STAR", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC orders the arm to stream the finalized star payload toward the router\"}"];

  "S_CONF_202_SEND_STAR" [label="S_CONF_202_SEND_STAR\nCONFIRM_SEND_STAR", fillcolor="#F4C95D", tooltip="{\"owner\": \"ARM\", \"role\": \"confirm\", \"description\": \"Arm acknowledges SEND_STAR and starts transmission on its UART link\"}"];

  "S_REQ_103_CANCEL_STAR" [label="S_REQ_103_CANCEL_STAR\nREQUEST_CANCEL_STAR", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC aborts a pending star buildup on the specified arm\"}"];

  "S_CONF_203_CANCEL_STAR" [label="S_CONF_203_CANCEL_STAR\nCONFIRM_CANCEL_STAR", fillcolor="#F4C95D", tooltip="{\"owner\": \"ARM\", \"role\": \"confirm\", \"description\": \"Arm reports cancellation completed and local buffers cleared\"}"];

  "S_REQ_104_STAR_ARRIVED" [label="S_REQ_104_STAR_ARRIVED\nREPORT_STAR_ARRIVED", fillcolor="#F4C95D", tooltip="{\"owner\": \"ARM\", \"role\": \"notify\", \"description\": \"Arm reports that its star payload reached the centerpiece ingress queue\"}"];

  "S_REQ_105_ADD_STAR" [label="S_REQ_105_ADD_STAR\nREQUEST_ADD_STAR", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC forwards ADD_STAR toward CENTER or TOP after router rewrites addressing\"}"];

  "S_CONF_205_ADD_STAR" [label="S_CONF_205_ADD_STAR\nCONFIRM_ADD_STAR", fillcolor="#5D8AA8", tooltip="{\"owner\": \"CENTER\", \"role\": \"confirm\", \"description\": \"Center or Top confirms the star payload has been stored safely\"}"];

  "S_REQ_106_BUILDUP_CLIMAX_CENTER" [label="S_REQ_106_BUILDUP_CLIMAX_CENTER\nREQUEST_BUILDUP_CLIMAX_CENTER", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC accelerates centerpiece buildup animation tempo\"}"];

  "S_CONF_206_BUILDUP_CLIMAX_CENTER" [label="S_CONF_206_BUILDUP_CLIMAX_CENTER\nCONFIRM_BUILDUP_CLIMAX_CENTER", fillcolor="#5D8AA8", tooltip="{\"owner\": \"CENTER\", \"role\": \"confirm\", \"description\": \"Centerpiece acknowledges the buildup speed change\"}"];

  "S_REQ_107_CLIMAX_READY" [label="S_REQ_107_CLIMAX_READY\nREPORT_CLIMAX_READY", fillcolor="#5D8AA8", tooltip="{\"owner\": \"CENTER\", \"role\": \"notify\", \"description\": \"Centerpiece announces that the climax threshold has been reached\"}"];

  "S_REQ_108_START_CLIMAX_CENTER" [label="S_REQ_108_START_CLIMAX_CENTER\nREQUEST_START_CLIMAX_CENTER", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC authorizes the centerpiece to eject queued stars toward the top piece\"}"];

  "S_CONF_208_START_CLIMAX_CENTER" [label="S_CONF_208_START_CLIMAX_CENTER\nCONFIRM_START_CLIMAX_CENTER", fillcolor="#5D8AA8", tooltip="{\"owner\": \"CENTER\", \"role\": \"confirm\", \"description\": \"Centerpiece confirms it has started ejecting stars during climax\"}"];

  "S_REQ_109_START_CLIMAX_TOP" [label="S_REQ_109_START_CLIMAX_TOP\nREQUEST_START_CLIMAX_TOP", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC commands the top piece to start its launch choreography\"}"];

  "S_CONF_209_START_CLIMAX_TOP" [label="S_CONF_209_START_CLIMAX_TOP\nCONFIRM_START_CLIMAX_TOP", fillcolor="#F28C28", tooltip="{\"owner\": \"TOP\", \"role\": \"confirm\", \"description\": \"Top piece confirms launch sequence\"}"];

  "S_REQ_110_STOP_CLIMAX_CENTER" [label="S_REQ_110_STOP_CLIMAX_CENTER\nREQUEST_STOP_CLIMAX_CENTER", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC issues a manual stop for the centerpiece climax motion\"}"];

  "S_CONF_210_STOP_CLIMAX_CENTER" [label="S_CONF_210_STOP_CLIMAX_CENTER\nCONFIRM_STOP_CLIMAX_CENTER", fillcolor="#5D8AA8", tooltip="{\"owner\": \"CENTER\", \"role\": \"confirm\", \"description\": \"Centerpiece reports it halted the climax routine\"}"];

  "S_REQ_111_STOP_CLIMAX_TOP" [label="S_REQ_111_STOP_CLIMAX_TOP\nREQUEST_STOP_CLIMAX_TOP", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"request\", \"description\": \"MAC issues a manual stop for the top piece launch\"}"];

  "S_CONF_211_STOP_CLIMAX_TOP" [label="S_CONF_211_STOP_CLIMAX_TOP\nCONFIRM_STOP_CLIMAX_TOP", fillcolor="#F28C28", tooltip="{\"owner\": \"TOP\", \"role\": \"confirm\", \"description\": \"Top piece reports it halted the launch routine\"}"];

  "S_REQ_301_START_IDLE" [label="S_REQ_301_START_IDLE\nBROADCAST_START_IDLE", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"broadcast\", \"description\": \"MAC sends START_IDLE broadcast through the router to every device\"}"];

  "S_CONF_401_START_IDLE" [label="S_CONF_401_START_IDLE\nCONFIRM_START_IDLE", fillcolor="#F28C28", tooltip="{\"owner\": \"ROUTER\", \"role\": \"confirm\", \"description\": \"Router aggregates field confirmations that idle mode engaged\"}"];

  "S_REQ_302_STOP_IDLE" [label="S_REQ_302_STOP_IDLE\nBROADCAST_STOP_IDLE", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"broadcast\", \"description\": \"MAC sends STOP_IDLE broadcast to end the idle animation\"}"];

  "S_CONF_402_STOP_IDLE" [label="S_CONF_402_STOP_IDLE\nCONFIRM_STOP_IDLE", fillcolor="#F28C28", tooltip="{\"owner\": \"ROUTER\", \"role\": \"confirm\", \"description\": \"Router aggregates confirmations that idle mode ended\"}"];

  "S_REQ_303_PING" [label="S_REQ_303_PING\nBROADCAST_PING", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"broadcast\", \"description\": \"MAC sends heartbeat PING broadcast for liveness checks\"}"];

  "S_CONF_403_PING" [label="S_CONF_403_PING\nCONFIRM_PING", fillcolor="#F28C28", tooltip="{\"owner\": \"ROUTER\", \"role\": \"confirm\", \"description\": \"Router collects alive responses from all devices\"}"];

  "S_REQ_304_RESET" [label="S_REQ_304_RESET\nBROADCAST_RESET", fillcolor="#5D8AA8", tooltip="{\"owner\": \"MAC\", \"role\": \"broadcast\", \"description\": \"MAC triggers an emergency RESET broadcast across the bus\"}"];

  "S_CONF_404_RESET" [label="S_CONF_404_RESET\nCONFIRM_RESET", fillcolor="#F28C28", tooltip="{\"owner\": \"ROUTER\", \"role\": \"confirm\", \"description\": \"Router aggregates reset confirmations before resuming routing\"}"];

  "S_ERR_500_COMM_ERROR" [label="S_ERR_500_COMM_ERROR\nCOMM_ERROR", fillcolor="#F28C28", tooltip="{\"owner\": \"ROUTER\", \"role\": \"error\", \"description\": \"Router surfaces communication errors or timeouts to the MAC for recovery\"}"];

  "S_IDLE_ROUTER" -> "S_REQ_101_MAKE_STAR" [label="mic_start_event\nID101 MAKE_STAR", tooltip="{\"trigger\": \"mic_start_event\", \"message\": \"ID101 MAKE_STAR\", \"notes\": \"MAC selects target arm; router prepends MASTER when forwarding\", \"payload\": \"arm_id,speed,color,brightness,size\"}"];

  "S_REQ_101_MAKE_STAR" -> "S_CONF_201_MAKE_STAR" [label="arm_ack_started\nID201 MAKE_STAR_CONFIRM", tooltip="{\"trigger\": \"arm_ack_started\", \"message\": \"ID201 MAKE_STAR_CONFIRM\", \"notes\": \"Router tags arm reply with source before relaying to MAC\", \"payload\": \"request_id,status\"}"];

  "S_CONF_201_MAKE_STAR" -> "S_REQ_102_SEND_STAR" [label="mic_session_complete\nID102 SEND_STAR", tooltip="{\"trigger\": \"mic_session_complete\", \"message\": \"ID102 SEND_STAR\", \"notes\": \"MAC closes capture window and requests payload transfer\", \"payload\": \"arm_id\"}"];

  "S_REQ_102_SEND_STAR" -> "S_CONF_202_SEND_STAR" [label="arm_ack_payload\nID202 SEND_STAR_CONFIRM", tooltip="{\"trigger\": \"arm_ack_payload\", \"message\": \"ID202 SEND_STAR_CONFIRM\", \"notes\": \"Router holds context until arm confirms transmission start\", \"payload\": \"request_id,status\"}"];

  "S_CONF_202_SEND_STAR" -> "S_REQ_105_ADD_STAR" [label="router_dispatch_to_center\nID105 ADD_STAR", tooltip="{\"trigger\": \"router_dispatch_to_center\", \"message\": \"ID105 ADD_STAR\", \"notes\": \"Router rewrites destination to CENTER or TOP and forwards bulk payload\", \"payload\": \"device_id,star_payload\"}"];

  "S_CONF_202_SEND_STAR" -> "S_REQ_104_STAR_ARRIVED" [label="arm_status_forward\nID104 STAR_ARRIVED", tooltip="{\"trigger\": \"arm_status_forward\", \"message\": \"ID104 STAR_ARRIVED\", \"notes\": \"Router pushes arm perspective update upstream to MAC\", \"payload\": \"arm_id,status\"}"];

  "S_REQ_104_STAR_ARRIVED" -> "S_REQ_104_STAR_ARRIVED" [label="router_ack_to_esp\nID104 STAR_ARRIVED", tooltip="{\"trigger\": \"router_ack_to_esp\", \"message\": \"ID104 STAR_ARRIVED\", \"notes\": \"Router emits CONFIRM:STAR_ARRIVED{status=received} back to ESP before returning to MAC\", \"payload\": \"arm_id,status\"}"];

  "S_REQ_104_STAR_ARRIVED" -> "S_REQ_105_ADD_STAR" [label="router_autoroute", tooltip="{\"trigger\": \"router_autoroute\", \"message\": \"\", \"notes\": \"Status update primes MAC to ensure ADD_STAR fan-out continues\", \"payload\": \"\"}"];

  "S_REQ_105_ADD_STAR" -> "S_CONF_205_ADD_STAR" [label="center_ack_buffered\nID205 ADD_STAR_CONFIRM", tooltip="{\"trigger\": \"center_ack_buffered\", \"message\": \"ID205 ADD_STAR_CONFIRM\", \"notes\": \"Centerpiece confirms storage; router clears pending payload flag\", \"payload\": \"request_id,status\"}"];

  "S_CONF_205_ADD_STAR" -> "S_REQ_106_BUILDUP_CLIMAX_CENTER" [label="mac_drives_buildup\nID106 BUILDUP_CLIMAX_CENTER", tooltip="{\"trigger\": \"mac_drives_buildup\", \"message\": \"ID106 BUILDUP_CLIMAX_CENTER\", \"notes\": \"MAC advances buildup pacing once minimum stars arrive\", \"payload\": \"buildup_time_ms\"}"];

  "S_REQ_106_BUILDUP_CLIMAX_CENTER" -> "S_CONF_206_BUILDUP_CLIMAX_CENTER" [label="center_ack_buildup\nID206 BUILDUP_CLIMAX_CENTER_CONFIRM", tooltip="{\"trigger\": \"center_ack_buildup\", \"message\": \"ID206 BUILDUP_CLIMAX_CENTER_CONFIRM\", \"notes\": \"Centerpiece confirms new buildup timing\", \"payload\": \"request_id,status\"}"];

  "S_CONF_206_BUILDUP_CLIMAX_CENTER" -> "S_REQ_107_CLIMAX_READY" [label="center_threshold_met\nID107 CLIMAX_READY", tooltip="{\"trigger\": \"center_threshold_met\", \"message\": \"ID107 CLIMAX_READY\", \"notes\": \"Centerpiece notifies MAC that climax conditions are satisfied\", \"payload\": \"device_id,status\"}"];

  "S_REQ_107_CLIMAX_READY" -> "S_REQ_107_CLIMAX_READY" [label="router_ack_to_esp\nID107 CLIMAX_READY", tooltip="{\"trigger\": \"router_ack_to_esp\", \"message\": \"ID107 CLIMAX_READY\", \"notes\": \"Router replies to ESP with CONFIRM:CLIMAX_READY{status=forwarded} before relaying to MAC\", \"payload\": \"device_id,status\"}"];

  "S_REQ_107_CLIMAX_READY" -> "S_REQ_108_START_CLIMAX_CENTER" [label="mac_authorizes_climax\nID108 START_CLIMAX_CENTER", tooltip="{\"trigger\": \"mac_authorizes_climax\", \"message\": \"ID108 START_CLIMAX_CENTER\", \"notes\": \"MAC grants centerpiece permission to start ejecting stars\", \"payload\": \"climax_time_ms\"}"];

  "S_REQ_108_START_CLIMAX_CENTER" -> "S_CONF_208_START_CLIMAX_CENTER" [label="center_ack_climax\nID208 START_CLIMAX_CENTER_CONFIRM", tooltip="{\"trigger\": \"center_ack_climax\", \"message\": \"ID208 START_CLIMAX_CENTER_CONFIRM\", \"notes\": \"Centerpiece confirms climax execution\", \"payload\": \"request_id,status\"}"];

  "S_CONF_208_START_CLIMAX_CENTER" -> "S_REQ_109_START_CLIMAX_TOP" [label="mac_orchestrates_top\nID109 START_CLIMAX_TOP", tooltip="{\"trigger\": \"mac_orchestrates_top\", \"message\": \"ID109 START_CLIMAX_TOP\", \"notes\": \"Router retargets command to TOP with MASTER source header\", \"payload\": \"climax_time_ms\"}"];

  "S_REQ_109_START_CLIMAX_TOP" -> "S_CONF_209_START_CLIMAX_TOP" [label="top_ack_launch\nID209 START_CLIMAX_TOP_CONFIRM", tooltip="{\"trigger\": \"top_ack_launch\", \"message\": \"ID209 START_CLIMAX_TOP_CONFIRM\", \"notes\": \"Top piece confirms launch sequence\", \"payload\": \"request_id,status\"}"];

  "S_CONF_209_START_CLIMAX_TOP" -> "S_REQ_110_STOP_CLIMAX_CENTER" [label="mac_manual_override\nID110 STOP_CLIMAX_CENTER", tooltip="{\"trigger\": \"mac_manual_override\", \"message\": \"ID110 STOP_CLIMAX_CENTER\", \"notes\": \"MAC issues center stop when manual override is triggered\", \"payload\": \"reason\"}"];

  "S_REQ_110_STOP_CLIMAX_CENTER" -> "S_CONF_210_STOP_CLIMAX_CENTER" [label="center_ack_stop\nID210 STOP_CLIMAX_CENTER_CONFIRM", tooltip="{\"trigger\": \"center_ack_stop\", \"message\": \"ID210 STOP_CLIMAX_CENTER_CONFIRM\", \"notes\": \"Centerpiece halts climax operations\", \"payload\": \"request_id,status\"}"];

  "S_CONF_210_STOP_CLIMAX_CENTER" -> "S_REQ_111_STOP_CLIMAX_TOP" [label="mac_followup_stop\nID111 STOP_CLIMAX_TOP", tooltip="{\"trigger\": \"mac_followup_stop\", \"message\": \"ID111 STOP_CLIMAX_TOP\", \"notes\": \"MAC cascades stop to the top piece\", \"payload\": \"reason\"}"];

  "S_REQ_111_STOP_CLIMAX_TOP" -> "S_CONF_211_STOP_CLIMAX_TOP" [label="top_ack_stop\nID211 STOP_CLIMAX_TOP_CONFIRM", tooltip="{\"trigger\": \"top_ack_stop\", \"message\": \"ID211 STOP_CLIMAX_TOP_CONFIRM\", \"notes\": \"Top piece confirms stop\", \"payload\": \"request_id,status\"}"];

  "S_CONF_211_STOP_CLIMAX_TOP" -> "S_IDLE_ROUTER" [label="router_clear_context", tooltip="{\"trigger\": \"router_clear_context\", \"message\": \"\", \"notes\": \"Router releases climax state and returns to idle\", \"payload\": \"\"}"];

  "S_REQ_101_MAKE_STAR" -> "S_REQ_103_CANCEL_STAR" [label="mac_cancel_during_capture\nID103 CANCEL_STAR", tooltip="{\"trigger\": \"mac_cancel_during_capture\", \"message\": \"ID103 CANCEL_STAR\", \"notes\": \"MAC aborts star creation while capture is ongoing\", \"payload\": \"arm_id\"}"];

  "S_REQ_102_SEND_STAR" -> "S_REQ_103_CANCEL_STAR" [label="mac_cancel_during_send\nID103 CANCEL_STAR", tooltip="{\"trigger\": \"mac_cancel_during_send\", \"message\": \"ID103 CANCEL_STAR\", \"notes\": \"MAC aborts star creation while payload is in flight\", \"payload\": \"arm_id\"}"];

  "S_REQ_103_CANCEL_STAR" -> "S_CONF_203_CANCEL_STAR" [label="arm_ack_cancel\nID203 CANCEL_STAR_CONFIRM", tooltip="{\"trigger\": \"arm_ack_cancel\", \"message\": \"ID203 CANCEL_STAR_CONFIRM\", \"notes\": \"Arm confirms cancellation\", \"payload\": \"request_id,status\"}"];

  "S_CONF_203_CANCEL_STAR" -> "S_IDLE_ROUTER" [label="router_drop_context", tooltip="{\"trigger\": \"router_drop_context\", \"message\": \"\", \"notes\": \"Router clears cancelled star context\", \"payload\": \"\"}"];

  "S_IDLE_ROUTER" -> "S_REQ_301_START_IDLE" [label="manual_idle_enable\nID301 START_IDLE", tooltip="{\"trigger\": \"manual_idle_enable\", \"message\": \"ID301 START_IDLE\", \"notes\": \"MAC enables idle playback across all devices\", \"payload\": \"mode\"}"];

  "S_REQ_301_START_IDLE" -> "S_CONF_401_START_IDLE" [label="devices_ack_idle\nID401 START_IDLE_CONFIRM", tooltip="{\"trigger\": \"devices_ack_idle\", \"message\": \"ID401 START_IDLE_CONFIRM\", \"notes\": \"Router aggregates START_IDLE confirms\", \"payload\": \"device_id,status\"}"];

  "S_CONF_401_START_IDLE" -> "S_IDLE_ROUTER" [label="router_idle_complete", tooltip="{\"trigger\": \"router_idle_complete\", \"message\": \"\", \"notes\": \"Router returns to idle after broadcast completion\", \"payload\": \"\"}"];

  "S_IDLE_ROUTER" -> "S_REQ_302_STOP_IDLE" [label="manual_idle_disable\nID302 STOP_IDLE", tooltip="{\"trigger\": \"manual_idle_disable\", \"message\": \"ID302 STOP_IDLE\", \"notes\": \"MAC stops idle playback across all devices\", \"payload\": \"mode\"}"];

  "S_REQ_302_STOP_IDLE" -> "S_CONF_402_STOP_IDLE" [label="devices_ack_stop_idle\nID402 STOP_IDLE_CONFIRM", tooltip="{\"trigger\": \"devices_ack_stop_idle\", \"message\": \"ID402 STOP_IDLE_CONFIRM\", \"notes\": \"Router aggregates STOP_IDLE confirms\", \"payload\": \"device_id,status\"}"];

  "S_CONF_402_STOP_IDLE" -> "S_IDLE_ROUTER" [label="router_resume_active", tooltip="{\"trigger\": \"router_resume_active\", \"message\": \"\", \"notes\": \"Router returns to idle after idle-stop broadcast\", \"payload\": \"\"}"];

  "S_IDLE_ROUTER" -> "S_REQ_303_PING" [label="heartbeat_tick\nID303 PING", tooltip="{\"trigger\": \"heartbeat_tick\", \"message\": \"ID303 PING\", \"notes\": \"MAC sends heartbeat ping\", \"payload\": \"timestamp\"}"];

  "S_REQ_303_PING" -> "S_CONF_403_PING" [label="devices_echo_ping\nID403 PING_CONFIRM", tooltip="{\"trigger\": \"devices_echo_ping\", \"message\": \"ID403 PING_CONFIRM\", \"notes\": \"Router collects ping replies\", \"payload\": \"device_id,status\"}"];

  "S_CONF_403_PING" -> "S_IDLE_ROUTER" [label="heartbeat_complete", tooltip="{\"trigger\": \"heartbeat_complete\", \"message\": \"\", \"notes\": \"Router returns to idle after heartbeat\", \"payload\": \"\"}"];

  "S_IDLE_ROUTER" -> "S_REQ_304_RESET" [label="operator_reset\nID304 RESET", tooltip="{\"trigger\": \"operator_reset\", \"message\": \"ID304 RESET\", \"notes\": \"MAC issues emergency reset broadcast\", \"payload\": \"reason\"}"];

  "S_REQ_304_RESET" -> "S_CONF_404_RESET" [label="devices_ack_reset\nID404 RESET_CONFIRM", tooltip="{\"trigger\": \"devices_ack_reset\", \"message\": \"ID404 RESET_CONFIRM\", \"notes\": \"Router aggregates reset confirmations\", \"payload\": \"device_id,status\"}"];

  "S_CONF_404_RESET" -> "S_IDLE_ROUTER" [label="router_reset_complete", tooltip="{\"trigger\": \"router_reset_complete\", \"message\": \"\", \"notes\": \"Router resumes idle after reset loop\", \"payload\": \"\"}"];

  "S_REQ_102_SEND_STAR" -> "S_ERR_500_COMM_ERROR" [label="router_timeout\nID500 COMM_ERROR", tooltip="{\"trigger\": \"router_timeout\", \"message\": \"ID500 COMM_ERROR\", \"notes\": \"Router escalates timeout while waiting for SEND_STAR payload\", \"payload\": \"device_id,error_code,error_text\"}"];

  "S_REQ_105_ADD_STAR" -> "S_ERR_500_COMM_ERROR" [label="center_timeout\nID500 COMM_ERROR", tooltip="{\"trigger\": \"center_timeout\", \"message\": \"ID500 COMM_ERROR\", \"notes\": \"Router escalates timeout waiting for center or top ACK\", \"payload\": \"device_id,error_code,error_text\"}"];

  "S_ERR_500_COMM_ERROR" -> "S_ERR_500_COMM_ERROR" [label="router_ack_to_esp\nID500 COMM_ERROR", tooltip="{\"trigger\": \"router_ack_to_esp\", \"message\": \"ID500 COMM_ERROR\", \"notes\": \"Router confirms receipt to ESP while escalating to MAC\", \"payload\": \"device_id,error_code,error_text\"}"];

  "S_ERR_500_COMM_ERROR" -> "S_REQ_304_RESET" [label="mac_recovery_reset", tooltip="{\"trigger\": \"mac_recovery_reset\", \"message\": \"\", \"notes\": \"MAC responds to COMM_ERROR by issuing broadcast RESET\", \"payload\": \"\"}"];

}